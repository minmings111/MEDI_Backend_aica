===============================================
MEDI ë°±ì—”ë“œ API ë¬¸ì„œ (í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œììš©)
===============================================

ğŸ“Œ ê¸°ë³¸ ì •ë³´
- ì„œë²„ ì£¼ì†Œ: http://localhost:8080
- ì¸ì¦ ë°©ì‹: ì„¸ì…˜ ê¸°ë°˜ (ì¿ í‚¤ ìë™ ê´€ë¦¬)
- Content-Type: application/json
- ì„¸ì…˜ ì¿ í‚¤ëª…: MEDI_SESSION

ğŸ“Œ ì¤‘ìš”ì‚¬í•­
- ëª¨ë“  ìš”ì²­ì— credentials: 'include' í•„ìš” (ì„¸ì…˜ ì¿ í‚¤ ì „ì†¡ìš©)
- ë¡œê·¸ì¸ í›„ ì„¸ì…˜ì´ ìë™ìœ¼ë¡œ ê´€ë¦¬ë¨
- ì„¸ì…˜ ë§Œë£Œì‹œê°„: 30ë¶„

===============================================
ğŸ” ì¸ì¦ ê´€ë ¨ API
===============================================

1. ë¡œê·¸ì¸
---------
POST /api/auth/login

ğŸ“ ì„¤ëª…: ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸í•˜ì—¬ ì„¸ì…˜ ìƒì„±

ğŸ“¤ ìš”ì²­ ë°ì´í„°:
{
  "email": "user@example.com",
  "password": "password123"
}

ğŸ“¥ ì„±ê³µ ì‘ë‹µ (200):
{
  "success": true,
  "message": "ë¡œê·¸ì¸ ì„±ê³µ",
  "user": {
    "id": 123,
    "email": "user@example.com",
    "name": "í™ê¸¸ë™",
    "role": "USER"
  },
  "sessionId": "A1B2C3D4E5F6"
}

ğŸ“¥ ì‹¤íŒ¨ ì‘ë‹µ (401):
{
  "success": false,
  "message": "ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤",
  "error": "INVALID_CREDENTIALS"
}

ğŸ’» í”„ë¡ íŠ¸ì—”ë“œ ì˜ˆì‹œ:
```javascript
const login = async (email, password) => {
  const response = await fetch('/api/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    credentials: 'include',
    body: JSON.stringify({ email, password })
  });
  
  const data = await response.json();
  if (data.success) {
    // ë¡œê·¸ì¸ ì„±ê³µ - ì‚¬ìš©ì ì •ë³´ ì €ì¥
    setUser(data.user);
    setIsLoggedIn(true);
  } else {
    // ë¡œê·¸ì¸ ì‹¤íŒ¨ - ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
    alert(data.message);
  }
};
```

===============================================

2. ë¡œê·¸ì•„ì›ƒ
----------
POST /api/auth/logout

ğŸ“ ì„¤ëª…: í˜„ì¬ ì„¸ì…˜ ë¬´íš¨í™”í•˜ì—¬ ë¡œê·¸ì•„ì›ƒ

ğŸ“¤ ìš”ì²­ ë°ì´í„°: ì—†ìŒ (ì„¸ì…˜ ì¿ í‚¤ë§Œ í•„ìš”)

ğŸ“¥ ì„±ê³µ ì‘ë‹µ (200):
{
  "success": true,
  "message": "ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤"
}

ğŸ’» í”„ë¡ íŠ¸ì—”ë“œ ì˜ˆì‹œ:
```javascript
const logout = async () => {
  const response = await fetch('/api/auth/logout', {
    method: 'POST',
    credentials: 'include'
  });
  
  const data = await response.json();
  if (data.success) {
    setUser(null);
    setIsLoggedIn(false);
    // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    window.location.href = '/login';
  }
};
```

===============================================

3. ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
-----------------
GET /api/auth/me

ğŸ“ ì„¤ëª…: í˜„ì¬ ë¡œê·¸ì¸ ìƒíƒœ ë° ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ

ğŸ“¤ ìš”ì²­ ë°ì´í„°: ì—†ìŒ (ì„¸ì…˜ ì¿ í‚¤ë§Œ í•„ìš”)

ğŸ“¥ ë¡œê·¸ì¸ëœ ê²½ìš° (200):
{
  "success": true,
  "authenticated": true,
  "user": {
    "id": 123,
    "email": "user@example.com",
    "name": "í™ê¸¸ë™",
    "role": "USER"
  },
  "sessionId": "A1B2C3D4E5F6"
}

ğŸ“¥ ë¹„ë¡œê·¸ì¸ ìƒíƒœ (200):
{
  "success": true,
  "authenticated": false,
  "message": "ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ"
}

ğŸ’» í”„ë¡ íŠ¸ì—”ë“œ ì˜ˆì‹œ:
```javascript
// ì•± ì‹œì‘ ì‹œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
const checkAuthStatus = async () => {
  const response = await fetch('/api/auth/me', {
    credentials: 'include'
  });
  
  const data = await response.json();
  if (data.authenticated) {
    setUser(data.user);
    setIsLoggedIn(true);
  } else {
    setUser(null);
    setIsLoggedIn(false);
  }
};

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
useEffect(() => {
  checkAuthStatus();
}, []);
```

===============================================

4. íšŒì›íƒˆí‡´
----------
DELETE /api/auth/withdraw

ğŸ“ ì„¤ëª…: í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ê³„ì • ì‚­ì œ (ì‹¤ì œ ë°ì´í„° ì‚­ì œ)
âš ï¸ ì£¼ì˜: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ í›„ í˜¸ì¶œ ê¶Œì¥

ğŸ“¤ ìš”ì²­ ë°ì´í„°: ì—†ìŒ (ì„¸ì…˜ ì¿ í‚¤ë§Œ í•„ìš”)

ğŸ“¥ ì„±ê³µ ì‘ë‹µ (200):
{
  "success": true,
  "message": "íšŒì›íƒˆí‡´ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤",
  "sessionCleared": true
}

ğŸ“¥ ì‹¤íŒ¨ ì‘ë‹µ:
- 401: ë¡œê·¸ì¸ í•„ìš”
- 404: ì‚¬ìš©ì ì •ë³´ ì—†ìŒ
- 500: ì„œë²„ ì˜¤ë¥˜

ğŸ’» í”„ë¡ íŠ¸ì—”ë“œ ì˜ˆì‹œ:
```javascript
const withdrawUser = async () => {
  // 1. ë¹„ë°€ë²ˆí˜¸ í™•ì¸
  const password = prompt("íƒˆí‡´ë¥¼ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
  if (!password) return;
  
  // 2. ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ (ë¡œê·¸ì¸ API ì¬ì‚¬ìš©)
  const loginCheck = await fetch('/api/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    credentials: 'include',
    body: JSON.stringify({
      email: currentUser.email,
      password: password
    })
  });
  
  if (!loginCheck.ok) {
    alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤');
    return;
  }
  
  // 3. ìµœì¢… í™•ì¸
  if (!confirm('ì •ë§ë¡œ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
    return;
  }
  
  // 4. íšŒì›íƒˆí‡´ ì‹¤í–‰
  const response = await fetch('/api/auth/withdraw', {
    method: 'DELETE',
    credentials: 'include'
  });
  
  const data = await response.json();
  if (data.success) {
    alert('íšŒì›íƒˆí‡´ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤');
    window.location.href = '/';
  } else {
    alert('íƒˆí‡´ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
  }
};
```

===============================================
ğŸ‘¥ íšŒì›ê°€ì… ê´€ë ¨ API (êµ¬í˜„ í•„ìš”)
===============================================

âš ï¸ ì£¼ì˜: ì•„ë˜ APIë“¤ì€ SecurityConfigì—ì„œ í—ˆìš©ë˜ì–´ ìˆì§€ë§Œ 
         ì‹¤ì œ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ êµ¬í˜„ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

5. ì´ë©”ì¼ ì¸ì¦ ì½”ë“œ ì „ì†¡
---------------------
POST /api/auth/send-verification

ğŸ“ ì„¤ëª…: íšŒì›ê°€ì…ìš© ì´ë©”ì¼ ì¸ì¦ ì½”ë“œ ì „ì†¡ (6ìë¦¬ ìˆ«ì)

ğŸ“¤ ìš”ì²­ ë°ì´í„°:
{
  "email": "user@example.com"
}

ğŸ“¥ ì˜ˆìƒ ì‘ë‹µ:
{
  "success": true,
  "message": "ì¸ì¦ ì½”ë“œê°€ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤",
  "expiresIn": 300
}

===============================================

6. ì´ë©”ì¼ ì¸ì¦ ì½”ë“œ í™•ì¸
---------------------
POST /api/auth/verify-email

ğŸ“ ì„¤ëª…: ì „ì†¡ë°›ì€ ì¸ì¦ ì½”ë“œ ê²€ì¦

ğŸ“¤ ìš”ì²­ ë°ì´í„°:
{
  "email": "user@example.com",
  "code": "123456"
}

ğŸ“¥ ì˜ˆìƒ ì‘ë‹µ:
{
  "success": true,
  "message": "ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤"
}

===============================================

7. íšŒì›ê°€ì…
----------
POST /api/auth/register

ğŸ“ ì„¤ëª…: ìƒˆ ì‚¬ìš©ì ê³„ì • ìƒì„± (ì´ë©”ì¼ ì¸ì¦ ì™„ë£Œ í›„)

ğŸ“¤ ìš”ì²­ ë°ì´í„°:
{
  "email": "user@example.com",
  "password": "password123",
  "name": "í™ê¸¸ë™",
  "phone": "010-1234-5678",
  "isTermsAgreed": true
}

ğŸ“¥ ì˜ˆìƒ ì‘ë‹µ:
{
  "success": true,
  "message": "íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤",
  "user": {
    "id": 123,
    "email": "user@example.com",
    "name": "í™ê¸¸ë™",
    "role": "USER"
  }
}

===============================================
ğŸ›¡ï¸ ë³´í˜¸ëœ API (ë¡œê·¸ì¸ í•„ìš”)
===============================================

8. ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
-----------------
GET /api/users

ğŸ“ ì„¤ëª…: ì „ì²´ ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ (ê´€ë¦¬ììš©)

ğŸ“¤ ìš”ì²­ ë°ì´í„°: ì—†ìŒ (ì„¸ì…˜ ì¿ í‚¤ í•„ìš”)

ğŸ“¥ ì„±ê³µ ì‘ë‹µ (200):
[
  {
    "id": 1,
    "email": "user1@example.com",
    "name": "ì‚¬ìš©ì1",
    "phone": "010-1111-1111",
    "role": "USER",
    "createdAt": "2024-01-01 10:00:00"
  },
  {
    "id": 2,
    "email": "user2@example.com",
    "name": "ì‚¬ìš©ì2",
    "phone": "010-2222-2222",
    "role": "USER",
    "createdAt": "2024-01-02 11:00:00"
  }
]

ğŸ“¥ ì¸ì¦ ì‹¤íŒ¨ (401):
{
  "success": false,
  "message": "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤",
  "error": "UNAUTHORIZED"
}

===============================================
ğŸ”§ ê³µí†µ ì—ëŸ¬ ì½”ë“œ
===============================================

HTTP ìƒíƒœ ì½”ë“œë³„ ì˜ë¯¸:
- 200: ì„±ê³µ
- 400: ì˜ëª»ëœ ìš”ì²­ (ì…ë ¥ê°’ ì˜¤ë¥˜)
- 401: ì¸ì¦ í•„ìš” (ë¡œê·¸ì¸ ì•ˆë¨)
- 403: ê¶Œí•œ ì—†ìŒ (ë¡œê·¸ì¸í–ˆì§€ë§Œ ê¶Œí•œ ë¶€ì¡±)
- 404: ë¦¬ì†ŒìŠ¤ ì—†ìŒ
- 500: ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜

ì—ëŸ¬ ì‘ë‹µ í˜•ì‹:
{
  "success": false,
  "message": "ì‚¬ìš©ìì—ê²Œ í‘œì‹œí•  ë©”ì‹œì§€",
  "error": "ERROR_CODE",
  "details": "ì¶”ê°€ ìƒì„¸ ì •ë³´ (ì„ íƒì‚¬í•­)"
}

ì£¼ìš” ì—ëŸ¬ ì½”ë“œ:
- UNAUTHORIZED: ë¡œê·¸ì¸ í•„ìš”
- INVALID_CREDENTIALS: ì˜ëª»ëœ ë¡œê·¸ì¸ ì •ë³´
- USER_NOT_FOUND: ì‚¬ìš©ì ì—†ìŒ
- INVALID_USER: ìœ íš¨í•˜ì§€ ì•Šì€ ì‚¬ìš©ì ì •ë³´
- WITHDRAWAL_FAILED: íšŒì›íƒˆí‡´ ì‹¤íŒ¨
- DATABASE_ERROR: ë°ì´í„°ë² ì´ìŠ¤ ì˜¤ë¥˜
- SESSION_ERROR: ì„¸ì…˜ ì˜¤ë¥˜
- INTERNAL_ERROR: ê¸°íƒ€ ì„œë²„ ì˜¤ë¥˜

===============================================
ğŸš€ í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ ê°€ì´ë“œ
===============================================

1. ì „ì—­ ìƒíƒœ ê´€ë¦¬ ì˜ˆì‹œ (React):
```javascript
// AuthContext.js
const AuthContext = createContext();

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const [loading, setLoading] = useState(true);
  
  // ì•± ì‹œì‘ ì‹œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
  useEffect(() => {
    checkAuthStatus();
  }, []);
  
  const checkAuthStatus = async () => {
    try {
      const response = await fetch('/api/auth/me', {
        credentials: 'include'
      });
      const data = await response.json();
      
      if (data.authenticated) {
        setUser(data.user);
        setIsLoggedIn(true);
      }
    } catch (error) {
      console.error('Auth check failed:', error);
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <AuthContext.Provider value={{
      user, setUser, isLoggedIn, setIsLoggedIn, loading
    }}>
      {children}
    </AuthContext.Provider>
  );
};
```

2. API í˜¸ì¶œ ìœ í‹¸ë¦¬í‹°:
```javascript
// api.js
const API_BASE = 'http://localhost:8080';

export const apiCall = async (endpoint, options = {}) => {
  const response = await fetch(`${API_BASE}${endpoint}`, {
    credentials: 'include',
    headers: {
      'Content-Type': 'application/json',
      ...options.headers
    },
    ...options
  });
  
  const data = await response.json();
  
  if (!response.ok) {
    throw new Error(data.message || 'API í˜¸ì¶œ ì‹¤íŒ¨');
  }
  
  return data;
};
```

3. ë³´í˜¸ëœ ë¼ìš°íŠ¸ ì»´í¬ë„ŒíŠ¸:
```javascript
// ProtectedRoute.js
const ProtectedRoute = ({ children }) => {
  const { isLoggedIn, loading } = useContext(AuthContext);
  
  if (loading) {
    return <div>ë¡œë”© ì¤‘...</div>;
  }
  
  if (!isLoggedIn) {
    return <Navigate to="/login" />;
  }
  
  return children;
};
```

===============================================
ğŸ“ ë¬¸ì˜ì‚¬í•­
===============================================

API ê´€ë ¨ ë¬¸ì˜ì‚¬í•­ì´ë‚˜ ì¶”ê°€ ê¸°ëŠ¥ì´ í•„ìš”í•œ ê²½ìš° 
ë°±ì—”ë“œ ê°œë°œíŒ€ì— ì—°ë½í•´ì£¼ì„¸ìš”.

ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2024-11-03
