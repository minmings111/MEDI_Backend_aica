spring:
  application:
    name: backend
  
  # --------------------------------------------------
  # 데이터베이스 설정 (환경 변수로 주입)
  # --------------------------------------------------
  datasource:
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver
  
  # --------------------------------------------------
  # JPA 설정
  # --------------------------------------------------
  jpa:
    hibernate:
      ddl-auto: none  # 프로덕션에서는 반드시 none
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.MySQLDialect
  
  # --------------------------------------------------
  # Redis 설정 (환경 변수로 주입)
  # --------------------------------------------------
  data:
    redis:
      host: ${SPRING_DATA_REDIS_HOST:redis}
      port: ${SPRING_DATA_REDIS_PORT:6379}
      timeout: 3000ms
      lettuce:
        pool:
          max-active: 10
          max-idle: 10
          min-idle: 2
  
  # --------------------------------------------------
  # Google OAuth2 설정 (환경 변수로 주입)
  # --------------------------------------------------
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_CLIENT_ID}
            client-secret: ${SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_CLIENT_SECRET}
            scope:
              - email
              - profile
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
        
        provider:
          google:
            authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
            token-uri: https://oauth2.googleapis.com/token
            user-info-uri: https://www.googleapis.com/oauth2/v3/userinfo
            user-name-attribute: sub
  
  # --------------------------------------------------
  # 이메일 설정 (환경 변수로 주입)
  # --------------------------------------------------
  mail:
    host: smtp.gmail.com
    port: 587
    username: ${SPRING_MAIL_USERNAME}
    password: ${SPRING_MAIL_PASSWORD}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
          connectiontimeout: 5000
          timeout: 5000
          writetimeout: 5000

# --------------------------------------------------
# MyBatis 설정
# --------------------------------------------------
mybatis:
  mapper-locations: classpath:mapper/**/*.xml
  type-aliases-package: com.medi.backend
  configuration:
    map-underscore-to-camel-case: true
    jdbc-type-for-null: NULL

# --------------------------------------------------
# CORS 설정 (환경 변수로 주입)
# --------------------------------------------------
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS}

# --------------------------------------------------
# 챗봇 API 설정 (환경 변수로 주입)
# --------------------------------------------------
chatbot:
  api-url: ${CHATBOT_API_URL:http://localhost:8000}

# --------------------------------------------------
# YouTube 동기화 설정
# --------------------------------------------------
youtube:
  sync:
    enabled: true
    max-concurrent-channels: 3
    delay-between-channels: 10
  
  data-api:
    max-results-per-page: 50
    request-timeout-seconds: 30

# --------------------------------------------------
# Spring Boot Actuator (모니터링)
# --------------------------------------------------
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when-authorized

# --------------------------------------------------
# 로깅 설정
# --------------------------------------------------
logging:
  level:
    root: INFO
    com.medi.backend: INFO
    org.springframework.web: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
  file:
    name: logs/application.log
    max-size: 10MB
    max-history: 30
